---
layout: post
title: "Factor Analysis"
date: "March 26, 2016"
categories: ['statistics', 'multivariate analysis']
---

* TOC
{:toc}

```{r, echo = FALSE, message = FALSE, warning = FALSE}
library(jn.general)
lib(data, viz)
library(MASS)
library(RColorBrewer)
knitr::opts_chunk$set(fig.width = 5, fig.height = 5, fig.align = 'center')
```


# Motivating Example
Consider a data set of test scores. There are $$n$$ test takers and test scores for $$6$$ subjects. There is high correlation across the subjects. 

```{r, echo = FALSE}
n <- 250
p <- 6
set.seed(1)
g <- mvrnorm(n, c(0,0), matrix(c(1,0.5,0.5,1), 2, 2))
Ystem <- g[,1] + matrix(rnorm(n*p/2, 0, 0.65), n, p/2)
Yhum <- g[,2] + matrix(rnorm(n*p/2, 0, 0.65), n, p/2)
Y <- cbind(Ystem, Yhum)
colnames(Y) <- c("Math", "Science", "CS", "Eng", "Hist", "Classics")
```

From the correlation matrix, there is a grouping of STEM and humanities subjects in correlation. The left plot is the actual data where there is high correlation among the subjects and within fields. The right plot is a hypothetical plot of what independent data would look like (shown for comparison).

```{r, echo = FALSE, fig.width = 10}
round(cor(Y),2)

indp_data <- matrix(rnorm(n*p), n, p)
colnames(indp_data) <- colnames(Y)
rownames(indp_data) <- rownames(Y)

y_plot <- reshape2::melt(cor(Y))
indp_plot <- reshape2::melt(cor(indp_data))


plot_heatmap <- function(d, title = ""){
  ggplot(data = d, aes(Var1, Var2, fill = value)) +
    geom_tile() + 
    labs(x = "", y = "", fill = "correlation", title = title) + 
    scale_fill_gradient(low = "white", high = "steelblue") +
    theme(legend.position = "bottom")
}
g1 <- plot_heatmap(y_plot, "Original (Correlated) Data")
g2 <- plot_heatmap(indp_plot, "Independent Data")
grid.arrange(g1, g2, nrow = 1)
```

This figure shows that there is correlation across subjects, revealing a potential underlying hidden factor (academic ability). There is also higher correlation within STEM fields and within humanities fields. This reveals a potential hidden factor that of STEM/humanities ability.

These hidden factors can be modeld with factor analysis. 

# Difference Between Factor Analysis and PCA

**Principal Components Analysis:**

* Components are calculated as linear combinations of original variables
* Goal is to explain as much of the total variance in the variables as possible
* Used to reduce the data into a smaller number of components

**Factor Analysis:**

* Original variables are defined as linear combination of the factors
* Goal is to explain the covariances/corelations between the variables
* Used to understand what constructs underlie the data

# Factor Model

Suppose there are $$p$$ variables ($$X_1$$, $$X_2$$, ..., $$X_p$$) measured on a sample of $$n$$ subjects, then the variable $$i$$ can be written as a linear combination of $$m$$ factors ($$f_1$$, $$f_2$$, ... $$f_m$$) where $$m < p$$.

$$\overrightarrow{X}_i = L_{pxm} \overrightarrow{f} + \overrightarrow{\epsilon}$$

where $$X_i$$ is a $$nx1$$ vector and $$L$$ is the matrix of factor loadings for variable $$i$$ and $$\overrightarrow{\epsilon}$$ is the portion of $$X_i$$ that cannot be explained by the factors.

For the example above $$\overrightarrow{f}$$ is a two element vector. The first element $$f_{1}$$ refers to the overall academic ability of that student and the second element $$f_{2}$$ is the difference in ability between STEM and humanities for that student. 


