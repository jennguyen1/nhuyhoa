---
layout: post
title: "OLS: Box-Cox Transformations"
date: "November 15, 2015"
categories: statistics linear_models
---

* TOC
{:toc}

```{r, echo = FALSE}
library(jn.general)
lib(data, viz)
knitr::opts_chunk$set(fig.width = 5, fig.height = 5, fig.align = 'center')
```

# Background
When regression diagnostics display a violation of assumptions, one step we can take is to transform our variables. The Box-Cox family of transformations provide a procedure for finding the best transformation. This parameterized family of transformations is continuous at $$y>0$$ for a fixed $$\lambda$$ and it is continuous at $$\lambda$$ for a fixed $$y$$, even at $$\lambda = 0$$. 

Let Y be the response variable. Then
$$\mathbf{y^{(\lambda})} = \left[\begin{array}
{rrr}
  \frac{y^{\lambda} - 1}{\lambda} & \lambda \ne 0 \\
  log(y) & \lambda = 0
\end{array}\right]$$

where $$Y(\lambda) $$ ~ $$N(X\beta, \sigma^2 I)$$.

The value $$\lambda$$ is found through maximum likelihood. 
$$ f(Y_i, X_i, i = 1...n$$ | $$ \lambda, \beta_0, \beta_1, \sigma^2) = \Pi^n_{i = 1} \frac{1}{\sqrt{2 \pi \sigma^2}} exp[\frac{-1}{2\sigma^2} (Y_i(\lambda) - \beta_0 - \beta_1 X_i)] $$

# Implementation
```{r, echo = FALSE}
lambda = c("-2", "-1", "-0.5", "0", "0.5", "1", "2")
transformation = c("Y^(-2)", "Y^(-1)", "Y^(-0.5)", "log(Y)", "Y^0.5", "Y", "Y^2")
data.frame(lambda, transformation) %>% kable
```

The $$\lambda$$ value corresponding to the best transformation can computed in R. 

We will use this example data set.
```{r, echo = FALSE}
survtimes <- c(0.31, 0.45, 0.46, 0.43, 0.45, 0.71, 0.66, 0.62, 0.36, 0.29, 0.40, 0.23, 0.56, 1.02, 0.71, 0.38)

P1 <- c(-1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1)
T1 <- c(-1, -1, -1, -1, 1, 1, 1, 1, -1, -1, -1, -1, 1, 1, 1, 1)

data <- data.frame(survtimes, A = factor(P1), B = factor(T1))
```

<div class = "dftab">
```{r, echo = FALSE}
data %>% nhuyhoa_df_print()
```
</div><p></p>

```{r}
# fit model - up to 2-way interactions
mod <- lm(survtimes ~ A*B, data = data)
# plot diagnostic plots
plot(mod$residuals ~ mod$fitted.values)
```
There is funneling pattern given in the resids vs fitted plot that indicates heteroskedaskticity.

```{r, message = FALSE}
# load the MASS package
library(MASS)

# run boxcox
bcmod <- boxcox(mod)
bcmod$x[bcmod$y == max(bcmod$y)]
```
From the boxcox method we see that $$\lambda = -0.303$$. This corresponds to the $log(Y)$$ transformation. (Note that the inverse square root transformation is ok too).

```{r}
# implement transformation
transmod <- lm(log(survtimes) ~ A*B, data = data)
plot(transmod$residuals ~ transmod$fitted.values)
```
After the transformation, we see that the prior heterskedaskticity has been alleviated. 
