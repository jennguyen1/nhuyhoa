---
layout: post
title: "Regression Confidence & Prediction Intervals"
date: "October 21, 2015"
categories: statistics
---

* TOC
{:toc}

```{r, echo = FALSE}
library(jn.general)
lib(data, viz)
```


# Confidence Intervals
Recall $$ Y_* = x_*\beta $$

Let $$ x'_* = (1, x_{0*}, ..., x_{*p}) $$ 

The expected value of Y is 
$$ E(Y) = \hat{Y}_* = x'_*\hat{\beta} $$

The variance of our estimate is
$$ Var(\hat{Y}_*) = Var(x'_*\hat{\beta}) = x'_*Var(\hat{\beta})x_* = \sigma^2x'_*(X'X)^{-1}x_* $$

thus $$ \hat{Y}_* $$ ~ $$ N(x'_*\hat{\beta}, \sigma^2x'_*(X'X)^{-1}x_*) $$

So the $$100(1-\alpha)$$% confidence interval is

$$ \hat{Y}_* \pm t_{n-p, \alpha/2} \sqrt{MSE} \sqrt{x'_*(X'X)^{-1}x_*} $$

# Prediction Intervals
If we want to predict new values, we incur additional error. 
$$ Y_0 = x'_0\beta + \epsilon_0 $$

We assume that $$ e_0 $$ ~ $$ N(0, \sigma^2) $$ and $$ e_0 \perp Y $$ 
Let $$ x'_0 = (1, x_{00}, ..., x_{0p}) $$

The expected value of Y is
$$ E(Y) = \hat{Y}_0 + 0 = x'_0\hat{\beta} $$

The variance of our estimate is
$$ Var(\hat{Y}_0) = Var(x'_0\hat{\beta} + \epsilon) = \sigma^2x'_0(X'X)^{-1}x_0 + \sigma^2 = \sigma^2 (x'_0(X'X)^{-1}x_0 + 1) $$

Thus the $$100(1-\alpha)$$% confidence interval is

$$ \hat{Y}_* \pm t_{n-p, \alpha/2} \sqrt{MSE} \sqrt{x'_*(X'X)^{-1}x_* + 1} $$

# Example
The plot below displays the fitted line (black), 95% confidence interval (blue), and 95% prediction intervals (green) for the estimated Y. Notice that the prediction intervals are much wider than the confidence intervals to account for prediction error. Also note that the bands are tighter around the $$\bar{x}$$ and wider at points farther away from $$\bar{x}$$. 

```{r, echo = FALSE}
x <- runif(100)
y <- 1 + 5*x + rnorm(100, 0.5, 1.5)
mod <- lm(y ~ x)
conf <- predict(mod, data.frame(x = x), interval = "confidence") %>% data.frame
pred <- predict(mod, data.frame(x = x), interval = "prediction") %>% data.frame

ggplot(data = NULL, aes(x = x, y = y)) + 
  geom_point(alpha = 0.75) + 
  geom_line(aes(x = x, y = conf$fit), color = "black", size = 1.25, alpha = 0.8) + 
  geom_line(aes(x = x, y = conf$lwr), color = "blue", linetype = "dashed", size = 1.25, alpha = 0.8) + 
  geom_line(aes(x = x, y = conf$upr), color = "blue", linetype = "dashed", size = 1.25, alpha = 0.8) + 
  geom_line(aes(x = x, y = pred$lwr), color = "green", linetype = "dashed", size = 1.25, alpha = 0.8) + 
  geom_line(aes(x = x, y = pred$upr), color = "green", linetype = "dashed", size = 1.25, alpha = 0.8) + 
  ggtitle("95% Confidnce and Prediction Intervals for Simulated Data") + xlab("X") + ylab("Y")
```

