---
layout: post
title: "Quantile Quantile (QQ) Plots"
date: "October 26, 2015"
categories: statistics
---

* TOC
{:toc}

```{r, echo = FALSE}
library(jn.general)
lib(data, viz)
```

# Why Use It?
QQ plots plot the quantiles of one distribution to the quantiles of another distribution. It can be used to assess exactly how the two data sets differ. When quantiles from a data set are compared with theoretical quantiles, we can conclude whether a data set follows a certain set of distributions. 

# QQ Plot Generation
The steps for generating a QQ plot comparing theoretical quantiles to empircal data is as follows:
1. Generate theoretical quantiles for your data
2. Standardize empirical data and sort from decreasing to increasing
3. Plot empircal quantiles vs theoretical quantiles

To compare two empirical data sets, just replace step 2 with step 3.

# Examples 
Let's generate data under the t distribution and see whether it follows a normal distribution (it shouldn't).
```{r, fig.width = 5, fig.height = 5}
# random data
set.seed(1)
x <- rt(500, 5)
# theoretical quantiles
quantiles <- qnorm(1:length(x)/length(x))
# order our values
ord.val <- sort((x - mean(x)) / sd(x))
# generate qqplot
qplot(x = quantiles, y = ord.val, geom = "point", main = "Is Our Data Normally Distributed?") + geom_abline(slope = 1)
```

We see a relatively straight line trend from -2 to 2 and more curvature at the tails. At the left tail, values under the t-distribution are smaller than corresponding values in the normal distribution. At the right tail, values under the t-distribution are larger than corresponding values in the normal distribution. We know that the t distribution is similar to the normal distribution but has fatter tails, so the QQ Plot confirms our knowledge. Thus we conclude that our data does not follow the normal distribution (which we know since we generated t-distributed data).

Now let's generate a QQ plot, with theoretical quantiles that are t-distributed.

```{r, fig.width = 5, fig.height = 5}
# theoretical quantiles
quantiles <- qt(1:length(x)/length(x), 5)
# generate qqplot
qplot(x = quantiles, y = ord.val, geom = "point", main = "Is Our Data T-Distributed?") + geom_abline(slope = 1)
```

Here we have a relatively straight line, so we can conclude that our data is t distributed, with degrees of freedom = 5.

Since normal data is so common, most statistical packages will have QQ-Normal plots built in. For example, in ggplot2 (R):

```{r, fig.width = 5, fig.height = 5}
qplot(sample = x, stat = "qq", main = "QQ-Normal Plot") + geom_abline(slope = 1)
```

## Deriving More Information With QQ Plots